(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{458:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一、环境信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、环境信息"}},[s._v("#")]),s._v(" 一、环境信息")]),s._v(" "),a("p",[s._v("Hyper-V 部署的麒麟 V10 SP1 最小化安装")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("主机")])]),s._v(" "),a("th",[a("strong",[s._v("配置")])]),s._v(" "),a("th",[a("strong",[s._v("地址")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Master")]),s._v(" "),a("td",[s._v("2C4G")]),s._v(" "),a("td",[s._v("192.168.254.101")])]),s._v(" "),a("tr",[a("td",[s._v("Node01")]),s._v(" "),a("td",[s._v("2C4G")]),s._v(" "),a("td",[s._v("192.168.254.102")])]),s._v(" "),a("tr",[a("td",[s._v("Node02")]),s._v(" "),a("td",[s._v("2C4G")]),s._v(" "),a("td",[s._v("192.168.254.103")])])])]),s._v(" "),a("h2",{attrs:{id:"二、组件清单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、组件清单"}},[s._v("#")]),s._v(" 二、组件清单")]),s._v(" "),a("h3",{attrs:{id:"_1-主节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主节点"}},[s._v("#")]),s._v(" 1.主节点")]),s._v(" "),a("p",[s._v("docker：也可以用其他容器运行时\nkubectl：集群命令行交互工具\nkubeadm：集群初始化工具")]),s._v(" "),a("h3",{attrs:{id:"_2-工作节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-工作节点"}},[s._v("#")]),s._v(" 2.工作节点")]),s._v(" "),a("p",[s._v("docker：也可以用其他容器运行时\nkubelet：管理 Pod 和容器，确保他们健康稳定运行\nkube-proxy：网络代理，负责网络相关的工作")]),s._v(" "),a("h2",{attrs:{id:"三、创建集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、创建集群"}},[s._v("#")]),s._v(" 三、创建集群")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://jimmysong.io/kubernetes-handbook/practice/install-kubernetes-on-centos.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://jimmysong.io/kubernetes-handbook/practice/install-kubernetes-on-centos.html"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_1-初始化系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化系统"}},[s._v("#")]),s._v(" 1.初始化系统")]),s._v(" "),a("h4",{attrs:{id:"_1-1-设置主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-设置主机名"}},[s._v("#")]),s._v(" 1.1.设置主机名")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("hostnamectl set-hostname devops\nhostnamectl set-hostname master\nhostnamectl set-hostname node01\nhostnamectl set-hostname node02\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_1-2-修改-hosts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-修改-hosts"}},[s._v("#")]),s._v(" 1.2.修改 hosts")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n192.168.254.100 devops\n192.168.254.101 master\n192.168.254.102 node01\n192.168.254.103 node02\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"_1-3-关闭-selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-关闭-selinux"}},[s._v("#")]),s._v(" 1.3.关闭 SELinux")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" --follow-symlinks "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/SELINUX=enforcing/SELINUX=disabled/g'")]),s._v(" /etc/sysconfig/selinux\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_1-4-关闭防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-关闭防火墙"}},[s._v("#")]),s._v(" 1.4.关闭防火墙")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_1-5-关闭-swap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-关闭-swap"}},[s._v("#")]),s._v(" 1.5.关闭 SWAP")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临时关闭")]),s._v("\nswapoff "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#永久关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释掉以下字段")]),s._v("\n/dev/mapper/centos-swap swap swap defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_1-6-时间同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-时间同步"}},[s._v("#")]),s._v(" 1.6.时间同步")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" ntpdate\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v("\n*/5 * * * * ntpdate ntp.aliyun.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装 epel-release 源，需要 RedHat 系")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_2-添加安装源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加安装源"}},[s._v("#")]),s._v(" 2.添加安装源")]),s._v(" "),a("p",[s._v("国内镜像站")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("https://developer.aliyun.com/mirror/docker-ce/\nhttps://mirrors.tuna.tsinghua.edu.cn/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_2-1-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-docker"}},[s._v("#")]),s._v(" 2.1.Docker")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/docker-ce.repo")]),s._v("\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable\nenabled=1\ngpgcheck=0\ngpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"_2-2-kubenetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-kubenetes"}},[s._v("#")]),s._v(" 2.2.Kubenetes")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_3-安装组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装组件"}},[s._v("#")]),s._v(" 3.安装组件")]),s._v(" "),a("p",[s._v("v1.24 版本及以上的 Kubernetes 放弃了原生 Docker 容器运行时的支持")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum list docker-ce.x86_64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--showduplicates")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce-20.10.10\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Cgroup\n\nyum list kube* "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--showduplicates")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubelet-1.23.6 kubectl-1.23.6 kubeadm-1.23.6\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_3-1-修改-docker-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-修改-docker-配置"}},[s._v("#")]),s._v(" 3.1.修改 Docker 配置")]),s._v(" "),a("p",[s._v("设置为 systemd，确保服务器节点在资源紧张的情况更加稳定")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "registry-mirrors": ["https://ustc-edu-cn.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\nsystemctl daemon-reload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Cgroup\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Kubernetes 官方推荐 Docker 等使用 systemd 作为 cgroupdriver，否则 kubelet 启动不了")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start kubelet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_3-2-kubectl-命令补全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-kubectl-命令补全"}},[s._v("#")]),s._v(" 3.2.kubectl 命令补全")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" bash-completion\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /usr/share/bash-completion/bash_completion\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubectl completion "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source <(kubectl completion bash)"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_4-初始化集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-初始化集群"}},[s._v("#")]),s._v(" 4.初始化集群")]),s._v(" "),a("p",[s._v("PS.如果没有关闭 SWAP，可以通过以下配置忽略 SWAP 报错")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysconfig/kubelet\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_EXTRA_ARGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--fail-swap-on=false"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_4-1-master-节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-master-节点"}},[s._v("#")]),s._v(" 4.1.Master 节点")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化集群控制台 control-plane，失败了可以用 kubeadm reset 重置")]),s._v("\nkubeadm init --kubernetes-version v1.23.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--apiserver-advertise-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.101 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--image-repository registry.aliyuncs.com/google_containers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--service-cidr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--pod-network-cidr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--ignore-preflight-errors"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Swap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[s._v("--kubernetes-version                     #指定 Kubernetes 版本")]),s._v(" "),a("li",[s._v("--apiserver-advertise-address       #指定 Master 主机的IP")]),s._v(" "),a("li",[s._v("--image-repository\t                       #指定阿里云镜像仓库地址")]),s._v(" "),a("li",[s._v("--service-cidr\t                               #指定 service 网络段")]),s._v(" "),a("li",[s._v("--pod-network-cidr                       #指定 pod 网络段")]),s._v(" "),a("li",[s._v("--ignore-preflight-errors=Swap    #忽略 Swap 报错信息，按需选择")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using Kubernetes version: v1.23.6\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running pre-flight checks\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulling images required "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" setting up a Kubernetes cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" This might take a minute or two, depending on the speed of your internet connection\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" You can also perform this action "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" beforehand using "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubeadm config images pull'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using certificateDir folder "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/pki"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ca"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" apiserver serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver-kubelet-client"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front-proxy-ca"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front-proxy-client"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/ca"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/server"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" etcd/server serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.101 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 ::1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/peer"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" etcd/peer serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.101 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 ::1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/healthcheck-client"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver-etcd-client"')]),s._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sa"')]),s._v(" key and public key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using kubeconfig folder "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin.conf"')]),s._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet.conf"')]),s._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"controller-manager.conf"')]),s._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scheduler.conf"')]),s._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing kubelet environment "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" with flags to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/kubelet/kubeadm-flags.env"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing kubelet configuration to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/kubelet/config.yaml"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting the kubelet\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using manifest folder "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-apiserver"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-controller-manager"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-scheduler"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" etcd "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wait-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelet to boot up the control plane as static Pods from directory "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" This can take up to 4m0s\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apiclient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All control plane components are healthy after "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22.503431")]),s._v(" seconds\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Storing the configuration used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubeadm-config"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system"')]),s._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating a ConfigMap "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet-config-1.23"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" namespace kube-system with the configuration "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the cluster\nNOTE: The "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet-config-1.23"')]),s._v(" naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet-config"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" Kubeadm upgrade will handle this transition transparently.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Skipping phase. Please see --upload-certs\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mark-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Marking the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" master as control-plane by adding the labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deprecated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mark-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Marking the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" master as control-plane by adding the taints "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node-role.kubernetes.io/master:NoSchedule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using token: qwrpqf.tb10u9boslu6mzoj\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow Node Bootstrap tokens to get nodes\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow Node Bootstrap tokens to post CSRs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" order "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" nodes to get long term certificate credentials\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" configured RBAC rules to allow certificate rotation "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" all "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" client certificates "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster-info"')]),s._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-public"')]),s._v(" namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-finalize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Updating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/kubelet.conf"')]),s._v(" to point to a rotatable kubelet client certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon: CoreDNS\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n\nAlternatively, "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you are the root user, you can run:\n\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBECONFIG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubectl apply -f [podnetwork].yaml"')]),s._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.101:6443 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" qwrpqf.tb10u9boslu6mzoj "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --discovery-token-ca-cert-hash sha256:14f18211150be68eb24efdc0053a6fd9587da1b77ea0050074f0bb87544926a0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://q.cnblogs.com/q/124871/",target:"_blank",rel:"noopener noreferrer"}},[s._v("后续修改网段"),a("OutboundLink")],1),s._v("\n然后等待拉取镜像，初始化完成以后按提示运行\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/2837990/1609838919007-894245b9-8210-498b-9614-89cc9b6ff5de.png#averageHue=%23fcf4e1&crop=0&crop=0&crop=1&crop=1&height=191&id=EIWC3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=382&originWidth=1178&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54421&status=done&style=none&title=&width=589",alt:"image.png"}}),s._v("\n记住 kubeadm jion 192.168.1.101:6443 ... 命令，以便后续 Node 节点加入集群")]),s._v(" "),a("ul",[a("li",[s._v("配置 kubectl")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#复制授权文件，以便其他节点 kubectl 可以有权限访问集群")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("添加网络组件\n否则 NotReady\n"),a("a",{attrs:{href:"https://github.com/coreos/flannel",target:"_blank",rel:"noopener noreferrer"}},[s._v("Flannel"),a("OutboundLink")],1),s._v(" 是一个专门为 K8s 定制的网络解决方案，主要解决 Pod 跨主机通信问题")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" kube-flannel.yml\nkubectl delete "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" kube-flanneld.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/2837990/1609841519635-1cc6cba3-325f-473b-bbd1-dd847c1e5121.png#averageHue=%23fbf4df&crop=0&crop=0&crop=1&crop=1&height=71&id=qPpdh&margin=%5Bobject%20Object%5D&name=image.png&originHeight=142&originWidth=607&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19881&status=done&style=none&title=&width=303.5",alt:"image.png"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 flannel 网络插件是否部署成功（Running 即为成功）")]),s._v("\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" flannel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Calico 包括原生 VXLAN 功能，无需 Flannel")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://raw.githubusercontent.com/projectcalico/calico/v3.24.5/manifests/canal.yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v("\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" canal.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_4-2-node-节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-node-节点"}},[s._v("#")]),s._v(" 4.2.Node 节点")]),s._v(" "),a("ul",[a("li",[s._v("节点加入集群")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.101:6443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" 7wor0d.7i31zm9hw330ay97 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--discovery-token-ca-cert-hash sha256:70970addce82343177ba403997644a2a38d7b8058724c5c22b8b1d5018c05560\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/2837990/1609900748622-7b7dc5a4-e5ce-42f0-b276-0630947c3101.png#averageHue=%23fcf4e0&crop=0&crop=0&crop=1&crop=1&height=158&id=SpkK1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=315&originWidth=1127&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57571&status=done&style=none&title=&width=563.5",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("配置 kubectl")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#复制授权文件，以便其他节点 kubectl 可以有权限访问集群")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过 cat /etc/kubernetes/admin.conf 拷贝 Master 节点内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_4-3-验证集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-验证集群"}},[s._v("#")]),s._v(" 4.3.验证集群")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl cluster-info\nkubectl version "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--short")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查看集群客户端和服务端程序版本信息\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/2837990/1609901147546-5c2fdb13-5778-4e5d-8258-4e4782ce82b6.png#averageHue=%23fcf4e0&crop=0&crop=0&crop=1&crop=1&height=37&id=ZbNZv&margin=%5Bobject%20Object%5D&name=image.png&originHeight=74&originWidth=463&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6573&status=done&style=none&title=&width=231.5",alt:"image.png"}}),s._v("\n查看集群信息\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/2837990/1609901184458-69d498ae-e8af-4ef7-aa59-97c28b24f30a.png#averageHue=%23faf1da&crop=0&crop=0&crop=1&crop=1&height=54&id=CxqKL&margin=%5Bobject%20Object%5D&name=image.png&originHeight=108&originWidth=1069&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19706&status=done&style=none&title=&width=534.5",alt:"image.png"}})]),s._v(" "),a("h2",{attrs:{id:"四、管理集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、管理集群"}},[s._v("#")]),s._v(" 四、管理集群")]),s._v(" "),a("h3",{attrs:{id:"_1-命令行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-命令行"}},[s._v("#")]),s._v(" 1.命令行")]),s._v(" "),a("h4",{attrs:{id:"_1-1-kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-kubectl"}},[s._v("#")]),s._v(" 1.1.kubectl")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\nkubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v("\nkubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\nkubectl get pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v("\nkubectl get pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_1-2-自动补全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-自动补全"}},[s._v("#")]),s._v(" 1.2.自动补全")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" bash-completion\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /usr/share/bash-completion/bash_completion\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubectl completion "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source <(kubectl completion bash)"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_2-web-界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-web-界面"}},[s._v("#")]),s._v(" 2.Web 界面")]),s._v(" "),a("h4",{attrs:{id:"_2-1-dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-dashboard"}},[s._v("#")]),s._v(" 2.1."),a("a",{attrs:{href:"https://github.com/kubernetes/dashboard",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dashboard"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Angular + Go、单集群、K8s 资源管理")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" recommended.yaml kubernetes-dashboard.yaml\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" kubernetes-dashboard.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-2-kuboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-kuboard"}},[s._v("#")]),s._v(" 2.2."),a("a",{attrs:{href:"https://github.com/eip-work/kuboard-press",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kuboard"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Vue、多集群、K8s 资源管理")]),s._v(" "),a("h4",{attrs:{id:"_2-3-kubevious"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-kubevious"}},[s._v("#")]),s._v(" 2.3."),a("a",{attrs:{href:"https://github.com/kubevious",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubevious"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("React、多集群、K8s 资源管理、全资源检索、资源回滚")]),s._v(" "),a("h4",{attrs:{id:"_2-4-kubesphere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-kubesphere"}},[s._v("#")]),s._v(" 2.4."),a("a",{attrs:{href:"https://github.com/kubesphere/kubesphere",target:"_blank",rel:"noopener noreferrer"}},[s._v("KubeSphere"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("React + Go、多集群、K8s 资源管理、CLI 安装、升级、KubeSphere Mini 入侵、应用商店")]),s._v(" "),a("h4",{attrs:{id:"_2-5-kubeoperator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-kubeoperator"}},[s._v("#")]),s._v(" 2.5."),a("a",{attrs:{href:"https://github.com/KubeOperator",target:"_blank",rel:"noopener noreferrer"}},[s._v("KubeOperator"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Vue + Go、多集群、K8s 资源管理、Web 安装、升级 K8s")]),s._v(" "),a("h2",{attrs:{id:"五、其他方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、其他方式"}},[s._v("#")]),s._v(" 五、其他方式")]),s._v(" "),a("h3",{attrs:{id:"_1-sealos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-sealos"}},[s._v("#")]),s._v(" 1."),a("a",{attrs:{href:"https://www.sealyun.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sealos"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"_1-1-安装-sealos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装-sealos"}},[s._v("#")]),s._v(" 1.1.安装 sealos")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/labring/sealos/releases/download/v4.0.0/sealos_4.0.0_linux_amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf sealos_4.0.0_linux_amd64.tar.gz sealos "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x sealos "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" sealos /usr/bin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_1-2-创建集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-创建集群"}},[s._v("#")]),s._v(" 1.2.创建集群")]),s._v(" "),a("ul",[a("li",[s._v("在线安装")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sealos run labring/kubernetes:v1.25.0 labring/calico:v3.24.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.101 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.102,192.168.254.103 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("离线安装\n离线环境只需要提前导入镜像，其它步骤与在线安装一致。\n首先在有网络的环境中 save 安装包：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sealos pull labring/kubernetes:v1.25.0\nsealos save "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" kubernetes.tar labring/kubernetes:v1.25.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("拷贝 kubernetes.tar 到离线环境, 使用 load 命令导入镜像即可：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sealos load "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" kubernetes.tar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("剩下的安装方式与在线安装一致。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sealos images "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群镜像是否导入成功")]),s._v("\nsealos run kuberentes:v1.25.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--single")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单机安装，集群安装同理")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-kubesphere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-kubesphere"}},[s._v("#")]),s._v(" 2."),a("a",{attrs:{href:"https://kubesphere.com.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubesphere"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);