(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{478:function(a,s,e){"use strict";e.r(s);var t=e(3),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/af277aad022de.png",alt:"社交银行架构图-Prometheus.drawio.png"}}),a._v("\n通常使用 Grafana 进行监控数据的展示，使用 AlertManager  组件进行提前预警")]),a._v(" "),s("h2",{attrs:{id:"prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[a._v("#")]),a._v(" Prometheus")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/prometheus/prometheus/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Prometheus"),s("OutboundLink")],1),a._v(" 是一套开源监控系统，使用 Go 语言开发，是 Google BorgMon 监控系统的类似实现；基本原理是通过 HTTP 协议周期性抓取被监控组件的状态，任意组件只要提供对应的 HTTP 接口就可以接入监控，输出监控信息的 HTTP 接口被称作 exporter，想要监控什么服务下载相应的 "),s("a",{attrs:{href:"https://github.com/orgs/prometheus/repositories?q=exporter&type=all",target:"_blank",rel:"noopener noreferrer"}},[a._v("exporter"),s("OutboundLink")],1),a._v(" 即可。")]),a._v(" "),s("h3",{attrs:{id:"安装-prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-prometheus"}},[a._v("#")]),a._v(" 安装 Prometheus")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/prometheus/prometheus/releases/download/v2.37.4/prometheus-2.37.4.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" prometheus-2.37.4.linux-amd64.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" /app/service/prometheus-2.37.4.linux-amd64 /app/service/prometheus\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /app/data/prometheus\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("修改配置"),s("code",[a._v("vi /app/service/prometheus/prometheus.yml")])]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#全局配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#隔 15s 采集一次数据")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("evaluation_interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#隔 15s 做一次告警检测")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# scrape_timeout is set to the global default (10s).")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Alertmanager configuration")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alerting")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alertmanagers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# - alertmanager:9093")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("rule_files")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定告警规则文件")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# - "first_rules.yml"')]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# - "second_rules.yml"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# A scrape configuration containing exactly one endpoint to scrape:")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Here it's Prometheus itself.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_configs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 指定监控的目标\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"prometheus"')]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# metrics_path defaults to '/metrics'")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# scheme defaults to 'http'.")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9090"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br")])]),s("h3",{attrs:{id:"启动-prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-prometheus"}},[a._v("#")]),a._v(" 启动 Prometheus")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#前台运行")]),a._v("\n/app/service/prometheus/prometheus "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config.file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/service/prometheus/prometheus.yml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--storage.tsdb.path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/data/prometheus\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#后台运行，"--web.enable-lifecycle" 通过 HTTP 请求重新加载配置')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" /app/service/prometheus/prometheus "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config.file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/service/prometheus/prometheus.yml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--storage.tsdb.path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/data/prometheus  --web.enable-lifecycle "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/logs/prometheus.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ef")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" prometheus\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重新加载配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST localhost:9090/-/reload\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"node-监控组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-监控组件"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://github.com/prometheus/node_exporter/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("node"),s("OutboundLink")],1),a._v(" 监控组件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/prometheus/node_exporter/releases/download/v1.4.0/node_exporter-1.4.0.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" node_exporter-1.4.0.linux-amd64.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v("  /app/service/node_exporter-1.4.0.linux-amd64 /app/service/node_exporter\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#启动")]),a._v("\n/app/service/node_exporter/node_exporter "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" /app/service/node_exporter/node_exporter "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/logs/node_exporter.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ef")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" node_exporter\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("添加配置"),s("code",[a._v("vi /app/service/prometheus/prometheus.yml")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("  - job_name: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"es_node_exporter"')]),a._v("\n    static_configs:\n      - targets: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.10.51:9100"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"mysqld-监控组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysqld-监控组件"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://prometheus.io/download/#mysqld_exporter",target:"_blank",rel:"noopener noreferrer"}},[a._v("mysqld"),s("OutboundLink")],1),a._v(" 监控组件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" mysqld_exporter-0.14.0.linux-amd64.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v("  /app/service/mysqld_exporter-0.14.0.linux-amd64 /app/service/mysqld_exporter\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"redis-监控组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-监控组件"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://github.com/oliver006/redis_exporter/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("redis"),s("OutboundLink")],1),a._v(" 监控组件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/oliver006/redis_exporter/releases/download/v1.45.0/redis_exporter-v1.45.0.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" redis_exporter-v1.45.0.linux-amd64.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v("  /app/service/redis_exporter-v1.45.0.linux-amd64 /app/service/redis_exporter\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#启动")]),a._v("\n/app/service/redis_exporter/redis_exporter "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" /app/service/redis_exporter/redis_exporter "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/logs/redis_exporter.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ef")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" redis_exporter\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("添加配置：vi /app/service/prometheus/prometheus.yml")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("  - job_name: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"redis_exporter"')]),a._v("\n    scrape_interval: 10s\n    static_configs:\n      - targets: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.10.51:9121"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"alertmanager-告警组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alertmanager-告警组件"}},[a._v("#")]),a._v(" alertmanager 告警组件")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://prometheus.io/download/#alertmanager",target:"_blank",rel:"noopener noreferrer"}},[a._v("alertmanager"),s("OutboundLink")],1),a._v(" 主要用于接收 Prometheus 发送的告警信息，它支持丰富的告警通知渠道，而且很容易做到告警信息进行去重，降噪，分组等，是一款前卫的告警通知系统。\n安装 alertmanager")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/prometheus/alertmanager/releases/download/v0.24.0/alertmanager-0.24.0.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" alertmanager-0.24.0.linux-amd64.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" alertmanager-0.24.0.linux-amd64 alertmanager\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("修改配置"),s("code",[a._v("vi alertmanager/alertmanager.yml")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("route:\n  group_by: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'alertname'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 1h\n  receiver: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'web.hook'")]),a._v("\nreceivers:\n  - name: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'web.hook'")]),a._v("\n    webhook_configs:\n      - url: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:5001/'")]),a._v("\ninhibit_rules:\n  - source_match:\n      severity: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'critical'")]),a._v("\n    target_match:\n      severity: "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'warning'")]),a._v("\n    equal: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'alertname'")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'dev'")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'instance'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("修改完成以后检查")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("/app/alertmanager/amtool check-config /app/alertmanager/alertmanager.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("启动 alertmanager")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("/app/alertmanager/alertmanager "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config.file")]),a._v(" /app/alertmanager/alertmanager.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"grafana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#grafana"}},[a._v("#")]),a._v(" Grafana")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://grafana.com/grafana/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Grafana"),s("OutboundLink")],1),a._v(" 是一个跨平台的开源的度量分析和可视化工具，可以通过将采集的数据查询然后可视化的展示，并及时通知。")]),a._v(" "),s("h3",{attrs:{id:"安装-grafana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-grafana"}},[a._v("#")]),a._v(" 安装 Grafana")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://dl.grafana.com/enterprise/release/grafana-enterprise-9.0.0.linux-amd64.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" grafana-enterprise-9.0.0.linux-amd64.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" /app/service/grafana-9.0.0 /app/service/grafana\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("按需修改配置文件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /app/service/grafana/conf/defaults.ini\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"启动-grafana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-grafana"}},[a._v("#")]),a._v(" 启动 Grafana")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" /app/service/grafana/bin/grafana-server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/logs/grafana-server.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ef")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" grafana-server\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h2",{attrs:{id:"可视化展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可视化展示"}},[a._v("#")]),a._v(" 可视化展示")]),a._v(" "),s("p",[a._v("浏览器访问 IP:3000，输入初始账户和密码：admin")]),a._v(" "),s("h3",{attrs:{id:"数据源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据源"}},[a._v("#")]),a._v(" 数据源")]),a._v(" "),s("p",[a._v("在 Grafana 左侧工具栏选择 Configuration，点击到下面的 Data sources，打开添加数据源的页面"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/a4a841eb516c2.png",alt:"image.png"}}),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/4d715da8bf2bd.png",alt:"image.png"}})]),a._v(" "),s("p",[a._v("点击页面中的 Add data source 按钮开始添加数据源，选择第一项 Prometheus 数据源进行配置"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/be7a06b2d6c38.png",alt:"image.png"}})]),a._v(" "),s("p",[a._v("在 HTTP 项中配置 URL 填写 Prometheus 的地址，Access 选择默认的 Server 代理方式，配置完成后，拉到最下方点击 Save & test，提示添加成功即表面数据源添加成功"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/e5e7d94298afa.png",alt:"image.png"}})]),a._v(" "),s("h3",{attrs:{id:"监控面板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控面板"}},[a._v("#")]),a._v(" 监控面板")]),a._v(" "),s("p",[a._v("可点击 Grafana 左侧菜单导入现有的 node_exporter 的仪表盘"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/ca71e96b62ff5.png",alt:"image.png"}})]),a._v(" "),s("p",[a._v("输入仪表盘 id（8919、16098），点击 Load"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/e7efb031566cc.png",alt:"image.png"}})]),a._v(" "),s("p",[a._v("选择使用 prometheus 数据源，然后点击 Import，即可得到一个完整监控 node_exporter 指标的仪表盘"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/32a92d99b263c.png",alt:"image.png"}})]),a._v(" "),s("p",[a._v("然后保存即可"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/b0bfb864d5178.png",alt:"image.png"}}),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/49b1c714c4eb9.png",alt:"image.png"}})]),a._v(" "),s("h3",{attrs:{id:"修改密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改密码"}},[a._v("#")]),a._v(" 修改密码")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("sqlite3 /app/service/grafana/data/grafana.db\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看数据库中包含的表")]),a._v("\n.tables\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看 user 表内容")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("select")]),a._v(" * from user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重置 admin 用户的密码为默认")]),a._v("\nupdate user "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" password "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'59acf18b94d7eb0694c61e60ce44c110c7a683ac6a8f09580d626f90f4a242000746579358d77dd9e570e83fa24faa88a8a6'")]),a._v(" where login "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'admin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#退出 sqlite3")]),a._v("\n.exit\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#修改指定用户为管理员")]),a._v("\nudpate user "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" is_admin "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" where login "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'xxxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("h2",{attrs:{id:"容器部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器部署"}},[a._v("#")]),a._v(" 容器部署")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" prometheus "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:9090:9090 prom/prometheus\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);