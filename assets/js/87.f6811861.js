(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{407:function(s,a,n){"use strict";n.r(a);var t=n(3),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("互联网技术的发展，机房里面机器的数量随之增加，运维的难度和复杂度也在增加，需要投入的运维人员和成本也在增加，从而催生了一系列的自动化运维工具（Ansible、SaltStack、Puppet）的产生来减少运维的成本。")]),s._v(" "),a("p",[s._v("Ansible、SaltStack、Puppet 都是目前比较受用户欢迎的自动化化运维工具，其中 Ansible 和 SaltStack 使用 Python 编写，具有良好的可移植性。Puppet 的使用脚本语法复杂，且可移植性比较差，目前的使用者慢慢变少。")]),s._v(" "),a("p",[s._v("Ansible 和 SaltStack 都是的目前最流行的自动化运维工具，能满足企业 IT 系统的自动化运维管理。")]),s._v(" "),a("p",[s._v("这两个工具都是用 Python 开发的，可以部署到不同的系统环境中和具有良好的二次开发特性。")]),s._v(" "),a("ul",[a("li",[s._v("在执行的命令的时候，Ansible 和 SaltStack 都支持 Ad-hoc 操作模式，也可以支持将命令写入 YAML 文件中再批量执行。")]),s._v(" "),a("li",[s._v("在处理返回结果方面，Ansible 和 SaltStack 的返回结果格式都是 JSON 格式，比较易懂和方便解析。")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://getansible.com/begin/an_zhuang_ansile",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://getansible.com/begin/an_zhuang_ansile"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"一、安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装"}},[s._v("#")]),s._v(" 一、安装")]),s._v(" "),a("h3",{attrs:{id:"_1-管理端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-管理端"}},[s._v("#")]),s._v(" 1.管理端")]),s._v(" "),a("p",[s._v("安裝 Ansible")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Redhat/CentOS Linux 上，Ansible 目前放在的 epel 源中，Fedora 默认源包含 Ansible")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ansible "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("配置 Ansible 管理节点和主机的连接，就是配置从"),a("strong",[s._v("管理节点到远程主机")]),s._v("之间基于 Key 的 "),a("strong",[s._v("SSH 连接")]),s._v("（免密登录）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成 ssh key")]),s._v("\nssh-keygen\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拷贝 ssh key 到远程主机，ssh 的时候就不需要输入密码了")]),s._v("\nssh-copy-id user@ip\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh 的时候不会提示是否保存 key")]),s._v("\nssh-keyscan "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/known_hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("运行 ssh 命令，既不需要输入密码，也不会提醒存储 key，就表示配置成功")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user@ip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-被控端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-被控端"}},[s._v("#")]),s._v(" 2.被控端")]),s._v(" "),a("p",[s._v("不需要安装特殊的包，只需要 Python > 2.4，RedHat 系列 Linux 一般安装方式都是默认安装的。")]),s._v(" "),a("h2",{attrs:{id:"二、配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、配置"}},[s._v("#")]),s._v(" 二、配置")]),s._v(" "),a("h3",{attrs:{id:"_1-主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主机"}},[s._v("#")]),s._v(" 1.主机")]),s._v(" "),a("p",[s._v("Host Inventory 是配置文件，用来告诉 Ansible 需要管理哪些主机，并且把这些主机进行分类\n默认的文件是： /etc/ansible/hosts")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最简单的 hosts 文件：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.50\naserver.example.org\nbserver.example.org\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#带分类的 hosts 文件:")]),s._v("\nmail.example.com\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfoo.example.com\nbar.example.com\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\none.example.com\ntwo.example.com\nthree.example.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_2-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-命令"}},[s._v("#")]),s._v(" 2.命令")]),s._v(" "),a("p",[s._v("Ansible 提供了一个命令行工具，在官方文档中起给命令行起了一个名字叫 Ad-Hoc Commands。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host-pattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查环境")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查所有的远程主机，是否以 app 用户创建了 ansible 主机可以访问的环境")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" app\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在所有的远程主机上，以当前 bash 的同名用户，在远程主机执行“echo bash”")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/echo hello"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拷贝文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拷贝文件 /etc/host 到远程主机（组）web，位置为 /tmp/hosts")]),s._v("\nansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" copy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=/etc/hosts dest=/tmp/hosts"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#远程主机（组）web 安装 yum 包 acme")]),s._v("\nansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=acme state=present"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加用户")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=foo password=<crypted password here>"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载 git 包")]),s._v("\nansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repo=git://foo.example.org/repo.git dest=/srv/myapp version=HEAD"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动服务")]),s._v("\nansible web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=httpd state=started"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#并行执行")]),s._v("\n启动 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 个并行进行执行重起\nansible lb "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/sbin/reboot"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看远程主机的全部系统信息")]),s._v("\nansible all "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" setup\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h3",{attrs:{id:"_3-脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-脚本"}},[s._v("#")]),s._v(" 3.脚本")]),s._v(" "),a("p",[s._v("为了避免重复输入命令，Ansible 提供脚本功能；Ansible 脚本的名字叫 Playbook，使用的是 YAML 格式（与 JSON 类似，是一种表示数据的格式），文件后缀 .yml。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-playbook deploy.yml\n\n---\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装 apache 的 play")]),s._v("\n- hosts: Web\n  remote_user: root\n  tasks:\n  - name: nginx\n    yum: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pkg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latest\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 mysql server 的 play")]),s._v("\n- hosts: db\n  remote_user: root\n  tasks:\n  - name: mysqld\n    yum: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pkg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mariadb "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"三、模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、模块"}},[s._v("#")]),s._v(" 三、模块")])])}),[],!1,null,null,null);a.default=e.exports}}]);