(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{392:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("不知不觉中，疫情已经来到第三个年头，居家办公逐渐成为常态；但大多企业内部系统（如 OA、ERP、CRM）要么位于本地局域网，要么白名单访问；")]),s._v(" "),a("p",[s._v("而现在的家庭宽带获取 IP 变动频繁甚至没有公网 IP，如何更稳定的保证外勤员工都能使用这些系统是重中之重。")]),s._v(" "),a("h2",{attrs:{id:"防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙"}},[s._v("#")]),s._v(" 防火墙")]),s._v(" "),a("p",[s._v("放行或者关闭防火墙")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"点对点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点对点"}},[s._v("#")]),s._v(" 点对点")]),s._v(" "),a("p",[s._v("一台固定公网 IP 的（VPS）服务器搭建相应的服务即可，客户端与服务器之间建立链路，客户端通过服务器网络访问企业内部 OA、ERP、CRM 等系统（添加服务器 IP 到白名单）\n使用 "),a("strong",[s._v("Squid")]),s._v(" 服务做正向代理")]),s._v(" "),a("ul",[a("li",[s._v("传统代理：适用于 Internet，需在客户机指定代理服务器的地址和端口")]),s._v(" "),a("li",[s._v("透明代理：")]),s._v(" "),a("li",[s._v("反向代理：")])]),s._v(" "),a("h3",{attrs:{id:"服务部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务部署"}},[s._v("#")]),s._v(" 服务部署")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" squid\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置开机启动")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" squid\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动服务")]),s._v("\nsystemctl start squid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"服务配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务配置"}},[s._v("#")]),s._v(" 服务配置")]),s._v(" "),a("p",[a("code",[s._v("vim /etc/squid/squid.conf")]),s._v("修改服务配置，如 acl 规则、服务端口http_port等")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Recommended minimum configuration:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example rule allowing access from your local networks.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Adapt to list your (internal) IP networks from where browsing")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# should be allowed")]),s._v("\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.0/8     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RFC1918 possible internal network")]),s._v("\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".0.0/12  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RFC1918 possible internal network")]),s._v("\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/16 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RFC1918 possible internal network")]),s._v("\nacl localnet src fc00::/7       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RFC 4193 local private network range")]),s._v("\nacl localnet src fe80::/10      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RFC 4291 link-local (directly plugged) machines")]),s._v("\n\nacl SSL_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ftp")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gopher")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("210")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wais")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1025")]),s._v("-65535  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unregistered ports")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("280")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http-mgmt")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("488")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gss-http")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("591")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# filemaker")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# multiling http")]),s._v("\nacl CONNECT method CONNECT\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Recommended minimum Access Permission configuration:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Deny requests to certain unsafe ports")]),s._v("\nhttp_access deny "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("Safe_ports\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Deny CONNECT to other than secure SSL ports")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http_access deny CONNECT !SSL_ports")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Only allow cachemgr access from localhost")]),s._v("\nhttp_access allow localhost manager\nhttp_access deny manager\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# We strongly recommend the following be uncommented to protect innocent")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# web applications running on the proxy server who think the only")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# one who can access services on "localhost" is a local user')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http_access deny to_localhost")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example rule allowing access from your local networks.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Adapt localnet in the ACL section to list your (internal) IP networks")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# from where browsing should be allowed")]),s._v("\nhttp_access allow localnet\nhttp_access allow localhost\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# And finally deny all other access to this proxy")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http_access deny all")]),s._v("\nhttp_access allow all\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Squid normally listens to port 3128")]),s._v("\nhttp_port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Uncomment and adjust the following to add a disk cache directory.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cache_dir ufs /var/spool/squid 100 16 256")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Leave coredumps in the first cache dir")]),s._v("\ncoredump_dir /var/spool/squid\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add any of your own refresh_pattern entries above these.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nrefresh_pattern ^ftp:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1440")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10080")]),s._v("\nrefresh_pattern ^gopher:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1440")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1440")]),s._v("\nrefresh_pattern "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/cgi-bin/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nrefresh_pattern "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4320")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br")])]),a("p",[s._v("修改完配置需要"),a("code",[s._v("systemctl restart squid")]),s._v("重启服务，不想访问的时候关闭服务即可")]),s._v(" "),a("h3",{attrs:{id:"服务日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务日志"}},[s._v("#")]),s._v(" 服务日志")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /var/log/squid/access.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("测试")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_proxy=http://10.240.216.197:8081"')]),s._v(" https://qyapi.weixin.qq.com/cgi-bin/gettoken\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"点对站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点对站"}},[s._v("#")]),s._v(" 点对站")]),s._v(" "),a("p",[s._v("对于需要访问本地文件服务器、局域网其他资源的需求；"),a("code",[s._v("点对站")]),s._v("则是在"),a("code",[s._v("点对点")]),s._v("的基础上扩展而来，即服务需要部署在局域网内部"),a("strong",[s._v("服务器")]),s._v("或者"),a("strong",[s._v("路由器网关")]),s._v("上")]),s._v(" "),a("h3",{attrs:{id:"ipsec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ipsec"}},[s._v("#")]),s._v(" IPsec")]),s._v(" "),a("h2",{attrs:{id:"站对站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#站对站"}},[s._v("#")]),s._v(" 站对站")]),s._v(" "),a("p",[s._v("此类方案用于多地办公室组网、资源互通，从"),a("code",[s._v("点对站")]),s._v("升级而来；有钱的企业可以直接上"),a("code",[s._v("BGP 组网")]),s._v("，小公司性价比就不是很高了")]),s._v(" "),a("h3",{attrs:{id:"zerotier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zerotier"}},[s._v("#")]),s._v(" ZeroTier")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.zerotier.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.zerotier.com/"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"wireguard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wireguard"}},[s._v("#")]),s._v(" WireGuard")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.wireguard.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.wireguard.com/"),a("OutboundLink")],1),s._v(" "),a("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/29/67361d0383468.png",alt:"image.png",title:"WireGuard 发送数据"}}),a("br"),s._v(" "),a("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/29/935f51fa96a83.png",alt:"image.png",title:"WireGuard 接受数据"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);