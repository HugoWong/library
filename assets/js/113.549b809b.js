(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{433:function(a,s,e){"use strict";e.r(s);var t=e(3),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[s("a",{attrs:{href:"https://zookeeper.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("ZooKeeper"),s("OutboundLink")],1),a._v(" 是 Apache 软件基金会的一个软件项目，它为大型分布式计算提供开源的分布式配置服务、同步服务和命名注册。")]),a._v(" "),s("p",[a._v("ZooKeeper 的架构通过冗余服务实现高可用性。")]),a._v(" "),s("p",[a._v("Zookeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。")]),a._v(" "),s("p",[a._v("一个典型的分布式数据一致性的解决方案，分布式应用程序可以基于它实现诸如数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理、Master 选举、分布式锁和分布式队列等功能。")]),a._v(" "),s("h2",{attrs:{id:"数据结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据结构"}},[a._v("#")]),a._v(" 数据结构")]),a._v(" "),s("p",[a._v("ZooKeeper 提供的名称空间非常类似于标准文件系统，key-value 的形式存储。名称 key 由斜线 / 分割的一系列路径元素，ZooKeeper 名称空间中的每个节点都是由一个路径标识。"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/1e064a71b0610.jpg",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"理论基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理论基础"}},[a._v("#")]),a._v(" 理论基础")]),a._v(" "),s("h3",{attrs:{id:"cap-理论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cap-理论"}},[a._v("#")]),a._v(" CAP 理论")]),a._v(" "),s("p",[a._v("CAP 指出对于一个分布式计算系统来说，不可能同时满足以下三点：")]),a._v(" "),s("ul",[s("li",[a._v("一致性：在分布式环境中，一致性是指数据在多个副本之间是否能够保持一致的特性，等同于所有节点访问同一份最新的数据副本。在一致性的需求下，当一个系统在数据一致的状态下执行更新操作后，应该保证系统的数据仍然处于一致的状态。")]),a._v(" "),s("li",[a._v("可用性：每次请求都能获取到正确的响应，但是不保证获取的数据为最新数据。")]),a._v(" "),s("li",[a._v("分区容错性：分布式系统在遇到任何网络分区故障的时候，仍然需要能够保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/13/efcc853fb31ca.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"base-理论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#base-理论"}},[a._v("#")]),a._v(" BASE 理论")]),a._v(" "),s("p",[a._v("BASE 是 Basically Available(基本可用)、Soft-state(软状态) 和 Eventually Consistent(最终一致性) 三个短语的缩写。")]),a._v(" "),s("ul",[s("li",[a._v("基本可用：在分布式系统出现故障，允许损失部分可用性（服务降级、页面降级）。")]),a._v(" "),s("li",[a._v("软状态：允许分布式系统出现中间状态。而且中间状态不影响系统的可用性。这里的中间状态是指不同的 data replication（数据备份节点）之间的数据更新可以出现延时的最终一致性。")]),a._v(" "),s("li",[a._v("最终一致性：data replications 经过一段时间达到一致性。")])]),a._v(" "),s("p",[a._v("BASE 理论是对 CAP 中的一致性和可用性进行一个权衡的结果，理论的核心思想就是：我们无法做到强一致，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性。"),s("br"),a._v(" "),s("img",{attrs:{src:"https://f.pz.al/pzal/2023/01/30/bab1b983320d3.png",alt:"image.png"}})]),a._v(" "),s("p",[a._v("需要先安装好"),s("code",[a._v("JDK")])]),a._v(" "),s("h2",{attrs:{id:"解压安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解压安装"}},[a._v("#")]),a._v(" 解压安装")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /app/software\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#解压并编译安装")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" apache-zookeeper-3.6.3-bin.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /app/midware\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" /app/midware/apache-zookeeper-3.6.3-bin /app/midware/zookeeper\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-pv")]),a._v(" /app/data/zookeeper\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[a._v("#")]),a._v(" 配置文件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#复制配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /app/midware/zookeeper/conf/zoo_sample.cfg /app/midware/zookeeper/conf/zoo.cfg\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /app/midware/zookeeper/conf/zoo.cfg\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/app/data/zookeeper\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#审核日志默关闭")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#INFO  [main:ZKAuditProvider@42] - ZooKeeper audit is disabled.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("audit.enable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#AdminServer 默认使用 8080 端口，如果已经占用会报错")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#ERROR [main:ServiceUtils@42] - Exiting JVM with code 4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#禁用 AdminServer")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("admin.enableServer")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#更换 AdminServer 端口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("admin.sererProt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("18080")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#集群需要")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("server.1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.101:2888:3888\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("server.2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.102:2888:3888\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("server.3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.103:2888:3888\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h2",{attrs:{id:"集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群部署"}},[a._v("#")]),a._v(" 集群部署")]),a._v(" "),s("p",[a._v("通过 scp 命令复制 /app/midware/zookeeper** **到其他需要部署 ZooKeeper 的服务器上")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /app/midware/zookeeper root@xxx.xxx.xxx.xxx:/app/midware\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("并依次输入如下命令")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/data/zookeeper/myid\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/data/zookeeper/myid\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /app/data/zookeeper/myid\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("然后分别启动")]),a._v(" "),s("h2",{attrs:{id:"相关命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关命令"}},[a._v("#")]),a._v(" 相关命令")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#启动 ZooKeeper")]),a._v("\n/app/midware/zookeeper/bin/zkServer.sh start\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#关闭 ZooKeeper")]),a._v("\n/app/midware/zookeeper/bin/zkServer.sh stop\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看 ZooKeeper 状态")]),a._v("\n/app/midware/zookeeper/bin/zkServer.sh status\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#进入命令模式")]),a._v("\n/app/midware/zookeeper/bin/zkCli.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);