(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{404:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一、服务说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、服务说明"}},[s._v("#")]),s._v(" 一、服务说明")]),s._v(" "),a("p",[s._v("FTP 是文件传输协议（File Transfer Protocol）的缩写，属于 TCP/IP 协议簇，用于 Internet 上控制文件的双向传输；SFTP 是一种安全的文件传输协议，通过网络传输文件的安全方法确保使用私有和安全的数据流来安全地传输数据。\nFTP 默认使用 TCP 协议的 20、21 端口用于客户端进行通信，SFTP 跟 SSH 一起使用默认端口为 22")]),s._v(" "),a("ul",[a("li",[s._v("20 端口用于建立数据连接，并传输文件数据")]),s._v(" "),a("li",[s._v("21 端口用于建立控制连接，并传输 FTP 控制命令")])]),s._v(" "),a("h3",{attrs:{id:"_1-主动模式-standard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主动模式-standard"}},[s._v("#")]),s._v(" 1.主动模式（Standard）")]),s._v(" "),a("p",[s._v("服务器主动发起数据连接，FTP 客户端首先和服务器的 TCP 21 端口建立连接，用来发送命令，客户端需要接收数据的时候在这个通道上发送 PORT 命令；PORT 命令包含了客户端用什么端口接收数据，在传送数据的时候，服务器端通过自己的 TCP 20 端口连接至客户端的指定端口发送数据；FTP Server 必须和客户端建立一个新的连接用来传送数据。")]),s._v(" "),a("h3",{attrs:{id:"_2-被动模式-passive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-被动模式-passive"}},[s._v("#")]),s._v(" 2.被动模式（Passive）")]),s._v(" "),a("p",[s._v("服务器被动等待数据连接，建立控制通道和 Standard 模式类似，但建立连接后发送 Pasv 命令；服务器收到 Pasv 命令后，打开一个临时端口（端口号大于 1023 小于 65535）并且通知客户端在这个端口上传送数据的请求，客户端连接 FTP 服务器此端口，然后 FTP 服务器将通过这个端口传送数据。")]),s._v(" "),a("h2",{attrs:{id:"二、服务部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、服务部署"}},[s._v("#")]),s._v(" 二、服务部署")]),s._v(" "),a("h3",{attrs:{id:"_1-scp-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-scp-命令"}},[s._v("#")]),s._v(" 1.SCP 命令")]),s._v(" "),a("p",[s._v("SCP 命令是用于通过 SSH 协议安全地将文件复制到远程系统和从远程系统复制文件到本地的命令")]),s._v(" "),a("ul",[a("li",[s._v("-1：强制 scp 命令使用协议 ssh1")]),s._v(" "),a("li",[s._v("-2：强制 scp 命令使用协议 ssh2")]),s._v(" "),a("li",[s._v("-4：强制 scp 命令只使用 IPv4 寻址")]),s._v(" "),a("li",[s._v("-6：强制 scp 命令只使用 IPv6 寻址")]),s._v(" "),a("li",[s._v("-B：使用批处理模式（传输过程中不询问传输口令或短语）")]),s._v(" "),a("li",[s._v("-C：允许压缩。（将 -C 标志传递给 ssh，从而打开压缩功能）")]),s._v(" "),a("li",[s._v("-p：保留原文件的修改时间，访问时间和访问权限")]),s._v(" "),a("li",[s._v("-q：不显示传输进度条")]),s._v(" "),a("li",[s._v("-r：递归复制整个目录")]),s._v(" "),a("li",[s._v("-v：详细方式显示输出；scp 和 ssh(1) 会显示出整个过程的调试信息")]),s._v(" "),a("li",[s._v("-c cipher：以 cipher 将数据传输进行加密，这个选项将直接传递给 ssh")]),s._v(" "),a("li",[s._v("-F ssh_config：指定一个替代的ssh配置文件，此参数直接传递给 ssh")]),s._v(" "),a("li",[s._v("-i identity_file：从指定文件中读取传输时使用的密钥文件，此参数直接传递给 ssh")]),s._v(" "),a("li",[s._v("-l limit： 限定用户所能使用的带宽，以 Kbit/s 为单位")]),s._v(" "),a("li",[s._v("-o ssh_option：如果习惯于使用 ssh_config(5) 中的参数传递方式")]),s._v(" "),a("li",[s._v("-P port：注意是大写的 P, port 是指定数据传输用到的端口号")]),s._v(" "),a("li",[s._v("-S program：指定加密传输时所使用的程序，此程序必须能够理解 ssh(1) 的选项")])]),s._v(" "),a("p",[a("strong",[s._v("从本地复制到远程")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" local_folder remote_username@remote_ip:remote_folder \n或\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" local_folder remote_ip:remote_folder \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("从远程复制到本地")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("从远程复制到本地，只要将从本地复制到远程的命令的后 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 个参数调换顺序即可\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-vsftpd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-vsftpd"}},[s._v("#")]),s._v(" 2.vsftpd")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://security.appspot.com/vsftpd.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("vsftpd"),a("OutboundLink")],1),s._v(" 是“very secure FTP daemon”的缩写，是一个 UNIX 类操作系统上运行的开源软件，它可以安全、快速、稳定地运行在 Linux、BSD、Solaris、HP-UX 以及 IRIX 上面。")]),s._v(" "),a("ul",[a("li",[s._v("绝大多数 linux 发行版服务器的包管理工具中都自带了 vsftpd 的安装包，直接安装即可")]),s._v(" "),a("li",[s._v("安装完毕后使用系统服务 systemd 对 vsftpd 进行启停等常规运维管理")]),s._v(" "),a("li",[s._v("按需对配置文件进行修改，配置文件地址一般为：/etc/vsftpd/vsftpd.conf")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("yum install "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y vsftpd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-1-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-配置文件"}},[s._v("#")]),s._v(" 2.1.配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/vsftpd/vsftpd.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_2-2-用户权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-用户权限"}},[s._v("#")]),s._v(" 2.2.用户权限")]),s._v(" "),a("p",[s._v("安装完毕后，服务会自动为我们创建一个名为 ftp 的用户，方便之后进行 ftp 连接")]),s._v(" "),a("h4",{attrs:{id:"_2-3-相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-相关命令"}},[s._v("#")]),s._v(" 2.3.相关命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加自启")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" vsftpd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动、重启、关闭")]),s._v("\nsystemctl start vsftpd\nsystemctl restart vsftpd\nsystemctl stop vsftpd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看状态")]),s._v("\nsystemctl status vsftpd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3-pure-ftpd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-pure-ftpd"}},[s._v("#")]),s._v(" 3.Pure-FTPd")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.pureftpd.org/project/pure-ftpd/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Pure-FTPd"),a("OutboundLink")],1),s._v(" 是一款专注于程序健壮和软件安全的免费 FTP 服务器软件（基于BSD License），以安全和配置简单为设计目标，支持虚拟主机，IPV6，PAM等功能；可以在多种类 Unix 操作系统中编译运行，包括：Linux、OpenBSD、NetBSD、FreeBSD、DragonFly BSD、Solaris、Tru64、Darwin、Irix and HP-UX，还有 Android 移植版本。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#包安装")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" epel-release\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pure-ftpd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.pureftpd.org/pub/pure-ftpd/releases/pure-ftpd-1.0.51.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" pure-ftpd-1.0.51.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" pure-ftpd-1.0.51\n./configure\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" pure-ftpd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_3-1-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-配置文件"}},[s._v("#")]),s._v(" 3.1.配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/pure-ftpd/pure-ftpd.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定路径，PureDB用户数据库文件")]),s._v("\nPureDB\t\t\t\t/etc/pure-ftpd/pureftpd.pdb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启日志 /var/log/pureftpd.log")]),s._v("\nVerboseLog\t\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拒绝匿名用户登录")]),s._v("\nNoAnonymous\t\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用被动模式，并限制端口范围")]),s._v("\nPassivePortRange\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("参数")])]),s._v(" "),a("th",[a("strong",[s._v("说明")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("ChrootEveryone yes")]),s._v(" "),a("td",[s._v("启用chroot，限制所有用户在其主目录中")])]),s._v(" "),a("tr",[a("td",[s._v("BrokenClientsCompatibility yes")]),s._v(" "),a("td",[s._v("兼容不同客户端")])]),s._v(" "),a("tr",[a("td",[s._v("Daemonize yes")]),s._v(" "),a("td",[s._v("后台运行")])]),s._v(" "),a("tr",[a("td",[s._v("MaxClientsPerIP 20")]),s._v(" "),a("td",[s._v("每个ip最大连接数")])]),s._v(" "),a("tr",[a("td",[s._v("VerboseLog yes")]),s._v(" "),a("td",[s._v("记录日志")])]),s._v(" "),a("tr",[a("td",[s._v("DisplayDotFiles no")]),s._v(" "),a("td",[s._v("显示隐藏文件")])]),s._v(" "),a("tr",[a("td",[s._v("AnonymousOnly no")]),s._v(" "),a("td",[s._v("只允许匿名用户访问")])]),s._v(" "),a("tr",[a("td",[s._v("NoAnonymous yes")]),s._v(" "),a("td",[s._v("不允许匿名用户连接")])]),s._v(" "),a("tr",[a("td",[s._v("SyslogFacility none")]),s._v(" "),a("td",[s._v("不将日志在syslog日志中显示")])]),s._v(" "),a("tr",[a("td",[s._v("DontResolve yes")]),s._v(" "),a("td",[s._v("不进行客户端DNS解析")])]),s._v(" "),a("tr",[a("td",[s._v("MaxIdleTime 15")]),s._v(" "),a("td",[s._v("最大空闲时间")])]),s._v(" "),a("tr",[a("td",[s._v("LimitRecursion 2000 8")]),s._v(" "),a("td",[s._v("浏览限制，文件2000，目录8层")])]),s._v(" "),a("tr",[a("td",[s._v("AnonymousCanCreateDirs no")]),s._v(" "),a("td",[s._v("匿名用户可以创建目录")])]),s._v(" "),a("tr",[a("td",[s._v("MaxLoad 4")]),s._v(" "),a("td",[s._v("超出负载后禁止下载")])]),s._v(" "),a("tr",[a("td",[s._v("PassivePortRange 45000 50000")]),s._v(" "),a("td",[s._v("被动模式端口范围")])]),s._v(" "),a("tr",[a("td",[s._v("AnonymousRatio 1 10")]),s._v(" "),a("td",[s._v("匿名用户上传/下载比率")])]),s._v(" "),a("tr",[a("td",[s._v("UserRatio 1 10")]),s._v(" "),a("td",[s._v("所有用户上传/下载比率")])]),s._v(" "),a("tr",[a("td",[s._v("AntiWarez yes")]),s._v(" "),a("td",[s._v("禁止下载匿名用户上传但未经验证的文件")])]),s._v(" "),a("tr",[a("td",[s._v("AnonymousBandwidth 200")]),s._v(" "),a("td",[s._v("匿名用户带宽限制（KB）")])]),s._v(" "),a("tr",[a("td",[s._v("UserBandwidth 8")]),s._v(" "),a("td",[s._v("所有用户最大带宽（KB）")])]),s._v(" "),a("tr",[a("td",[s._v("Umask 133:022")]),s._v(" "),a("td",[s._v("创建文件/目录默认掩码")])]),s._v(" "),a("tr",[a("td",[s._v("MinUID 100")]),s._v(" "),a("td",[s._v("最大UID限制")])]),s._v(" "),a("tr",[a("td",[s._v("AllowUserFXP no")]),s._v(" "),a("td",[s._v("仅运行用户进行FXP传输")])]),s._v(" "),a("tr",[a("td",[s._v("AllowAnonymousFXP no")]),s._v(" "),a("td",[s._v("对匿名用户和非匿名用户允许进行匿名 FXP 传输")])]),s._v(" "),a("tr",[a("td",[s._v("ProhibitDotFilesWrite no")]),s._v(" "),a("td",[s._v("不能删除/写入隐藏文件")])]),s._v(" "),a("tr",[a("td",[s._v("ProhibitDotFilesRead no")]),s._v(" "),a("td",[s._v("禁止读取隐藏文件")])]),s._v(" "),a("tr",[a("td",[s._v("AutoRename yes")]),s._v(" "),a("td",[s._v("有同名文件时自动重新命名")])]),s._v(" "),a("tr",[a("td",[s._v("AnonymousCantUpload yes")]),s._v(" "),a("td",[s._v("不允许匿名用户上传文件")])]),s._v(" "),a("tr",[a("td",[s._v("AltLog clf:/var/log/pureftpd.log clf")]),s._v(" "),a("td",[s._v("格式日志文件位置")])]),s._v(" "),a("tr",[a("td",[s._v("LDAPConfigFile /etc/pureftpd-ldap.conf")]),s._v(" "),a("td",[s._v("LDAP 配置文件")])]),s._v(" "),a("tr",[a("td",[s._v("MySQLConfigFile /etc/pureftpd-mysql.conf")]),s._v(" "),a("td",[s._v("MySQL 配置文件 (参考 README.MySQL)")])]),s._v(" "),a("tr",[a("td",[s._v("PGSQLConfigFile /etc/pureftpd-pgsql.conf")]),s._v(" "),a("td",[s._v("Postgres 配置文件 (参考 README.PGSQL)")])]),s._v(" "),a("tr",[a("td",[s._v("PureDB /etc/pure-ftpd/pureftpd.pdb")]),s._v(" "),a("td",[s._v("用户数据库文件")])]),s._v(" "),a("tr",[a("td",[s._v("MaxDiskUsage 99")]),s._v(" "),a("td",[s._v("当磁盘使用量打到99%时禁止上传")])]),s._v(" "),a("tr",[a("td",[s._v("CreateHomeDir yes")]),s._v(" "),a("td",[s._v("如果虚拟用户的目录不存在则自动创建")])]),s._v(" "),a("tr",[a("td",[s._v("CustomerProof yes")]),s._v(" "),a("td",[s._v("防止命令误操作")])]),s._v(" "),a("tr",[a("td",[s._v("LogPID yes")]),s._v(" "),a("td",[s._v("如果你要为日志每一行添加 PID 去掉下面行的注释")])]),s._v(" "),a("tr",[a("td",[s._v("NoChmod yes")]),s._v(" "),a("td",[s._v("不接受 CHMOD 命令用户不能更改他们文件的属性")])]),s._v(" "),a("tr",[a("td",[s._v("KeepAllFiles yes")]),s._v(" "),a("td",[s._v("允许用户恢复和上传文件，却不允许删除他们")])])])]),s._v(" "),a("h4",{attrs:{id:"_3-2-用户权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-用户权限"}},[s._v("#")]),s._v(" 3.2.用户权限")]),s._v(" "),a("p",[s._v("添加 ftp 用户组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" www\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" www "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /sbin/nologin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /dev/null www\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("创建虚拟账户")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" www "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" www "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /opt/www "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-3-相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-相关命令"}},[s._v("#")]),s._v(" 3.3.相关命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取命令帮助")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建用户信息数据库")]),s._v("\npure-pw mkdb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#增加一个虚用户")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改用户信息")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除一个虚用户")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("userdel")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改用户密码")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看用户信息")]),s._v("\npure-pw show www\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改用户上传路径")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" www "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /opt/www "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改用户密码")]),s._v("\npure-pw "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" www\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h3",{attrs:{id:"_4-nfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-nfs"}},[s._v("#")]),s._v(" 4.NFS")]),s._v(" "),a("h4",{attrs:{id:"_4-1-安装服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装服务"}},[s._v("#")]),s._v(" 4.1.安装服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum 安装")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" nfs-utils rpcbind\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rpm 包安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" nfs-utils-1.3.0-0.68.el7.2.x86_64.rpm rpcbind-0.2.0-49.el7.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动并设置开机自启")]),s._v("\nsystemctl start nfs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start rpcbind\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nfs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rpcbind\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_4-2-创建共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-创建共享"}},[s._v("#")]),s._v(" 4.2.创建共享")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建文件夹并赋予读写权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pv")]),s._v(" /data/nfs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" /data/nfs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置共享文件夹及挂载权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/exports\n/data/nfs "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/data/nfs *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,no_root_squash,no_all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新加载 NFS 配置")]),s._v("\nsystemctl reload nfs\nexports "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\nshowmount "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" xxx.xxx.xxx.xxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_4-3-挂载共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-挂载共享"}},[s._v("#")]),s._v(" 4.3.挂载共享")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pv")]),s._v(" /app/data\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临时挂载，vers=3 解决权限 nobody 的问题 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nfs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.x:/data/nfs /app/data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#永久挂载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.x:/data/nfs /app/data nfs defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查挂载点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_4-4-其余选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-其余选项"}},[s._v("#")]),s._v(" 4.4.其余选项")]),s._v(" "),a("p",[s._v("挂载文件系统时可使用半角逗号“,”分隔设置多种挂载选项：")]),s._v(" "),a("ul",[a("li",[s._v("rsize：定义数据块的大小，用于客户端与文件系统之间读取数据；建议值：1048576")]),s._v(" "),a("li",[s._v("wsize：定义数据块的大小，用于客户端与文件系统之间写入数据；建议值：1048576")])]),s._v(" "),a("p",[s._v("PS.如果需要更改 IO 大小参数（rsize & wsize），建议尽可能使用最大值：1048576，以避免性能下降")]),s._v(" "),a("ul",[a("li",[s._v("hard：在共享暂时不可用的情况下，应用程序会停止并等待至恢复在线状态，按需启用该参数")]),s._v(" "),a("li",[s._v("timeo：超时参数，搭配 hard 使用，单位为 0.1 秒，建议值：150-600（15-60s）")]),s._v(" "),a("li",[s._v("retrans：重试次数，建议值：2")]),s._v(" "),a("li",[s._v("noresvport：重连时使用新的 TCP 端口，保障在网络发生故障恢复时不会中断连接，建议启用该参数")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nfs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(",proto"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp,rsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v(",wsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v(",hard,timeo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(",retrans"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",noresvport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.x:/data/nfs /app/data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5-samba"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-samba"}},[s._v("#")]),s._v(" 5.Samba")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" samba\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5-1-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置文件"}},[s._v("#")]),s._v(" 5.1.配置文件")]),s._v(" "),a("p",[s._v("Samba 服务的主配置文件：/etc/samba/smb.conf")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/samba/smb.conf\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改为 Windows 下组名称")]),s._v("\nworkgroup "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" WORKGROUP\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新版本已经取消这种验证方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#security = share")]),s._v("\nsecurity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Guest 访问必备")]),s._v("\nmap to guest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Bad Password\npassdb backend "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tdbsam\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许访问的 IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#host allow =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#共享名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Public"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncomment "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Public\npath "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /home/share/public\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示共享目录")]),s._v("\nbrowseable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许写入")]),s._v("\nwritable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许 guest 访问")]),s._v("\npublic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nguest ok "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许访问的用户 ，@为组")]),s._v("\nvalid "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gg @gg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许写入的用户 ，@为组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root @root\ncreate mask "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0777\ndirectory "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mask")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0777\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("PS.Samba 有四种安全级别（v4.1.1 及以上版本不支持 share 和 server）：")]),s._v(" "),a("ul",[a("li",[s._v("share：不需要用户名和密码就可登陆")]),s._v(" "),a("li",[s._v("user：默认级别，需要输入用户名和密码")]),s._v(" "),a("li",[s._v("server：由另外一台 Samba 服务器来对用户进行身份验证")]),s._v(" "),a("li",[s._v("domain：把 Samba 服务器加入到域，由域控制器来进行身份验证")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建相应的目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" 0777 /home/share/public\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备份共享文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" cvpzf ys_share_backup.tgz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_5-2-用户权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-用户权限"}},[s._v("#")]),s._v(" 5.2.用户权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用新版 tdbsam 管理帐号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建 Samba 账户")]),s._v("\npdbedit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" username\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除 Samba 账户")]),s._v("\npdbedit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" username\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示账户详细信息")]),s._v("\npdbedit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" username\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出 Samba 用户列表，读取 passdb.tdb 数据库文件")]),s._v("\npdbedit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出 Samba 用户列表详细信息")]),s._v("\npdbedit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Lv")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_5-3-相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-相关命令"}},[s._v("#")]),s._v(" 5.3.相关命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加开机启动")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" smb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动、关闭、重启 SMB 服务")]),s._v("\nsystemctl start smb\nsystemctl stop smb\nsystemctl restart smb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看 SMB 服务状态")]),s._v("\nsystemctl status smb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"三、服务故障"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、服务故障"}},[s._v("#")]),s._v(" 三、服务故障")]),s._v(" "),a("p",[s._v("一般服务启动错误，可以用“journalctl -xe”查看错误信息")]),s._v(" "),a("h3",{attrs:{id:"_1-无法访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-无法访问"}},[s._v("#")]),s._v(" 1.无法访问")]),s._v(" "),a("p",[s._v("网络正常，服务启动的情况下还是无法访问，基本就是防火墙的问题，需要关闭或者放行相应的端口：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#放行端口")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("137")]),s._v("/tcp\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("138")]),s._v("/tcp\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("139")]),s._v("/tcp\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("445")]),s._v("/tcp\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("901")]),s._v("/tcp\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭防火墙")]),s._v("\nsystemctl stop firewalld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其他命令")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" firewalld\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开机启动")]),s._v("\nsystemctl disable firewalld\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#禁止开机启动")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_2-无效权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-无效权限"}},[s._v("#")]),s._v(" 2.无效权限")]),s._v(" "),a("p",[s._v("一切配置好，但是就是无法获取写入权限，排查发现是 Linux 的 Selinux 问题：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\t\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临时停止 Selinux")]),s._v("\nvm /etc/sysconfig/selinux\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑文件永久关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_3-共享权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-共享权限"}},[s._v("#")]),s._v(" 3.共享权限")]),s._v(" "),a("p",[s._v("NFS 服务端和客户端用户、用户组 ID 不一致时会出现共享目录用户、用户组变成 ID；修改用户、用户组 ID 为相同的")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" app\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);