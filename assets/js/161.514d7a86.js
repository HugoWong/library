(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{479:function(s,a,n){"use strict";n.r(a);var t=n(3),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Squid 是一个高性能的代理缓存服务器，Squid 支持 FTP、gopher、HTTPS 和 HTTP 协议；和一般的代理缓存软件不同，Squid 用一个单独的、非模块化的、I/O 驱动的进程来处理所有的客户端请求。\n主要提供缓存加速、应用层过滤控制的功能，能代替客户机向网站请求数据，从而可以隐藏用户的真实 IP 地址；将获得的网页数据（静态 Web 元素）保存到缓存中并发送给客户机，以便下次请求相同的数据时快速响应。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl stop firewalld "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl disable firewalld\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc gcc-c++ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" perl\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pv")]),s._v(" /app/service/squid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("a",{attrs:{href:"http://www.squid-cache.org/Versions/v5/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.squid-cache.org/Versions/v5/"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"https://www.phpfans.net/manu/Squid/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.phpfans.net/manu/Squid/"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"编译安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译安装"}},[s._v("#")]),s._v(" 编译安装")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://www.squid-cache.org/Versions/v5/squid-5.6.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /app/software\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" squid-5.6.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" squid-5.6\n./configure "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/app/service/squid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sysconfdir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/app/service/squid/conf --enable-arp-acl --enable-linux-netfilter --enable-linux-tproxy --enable-async-io"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" --enable-err-language"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Simplify_Chinese"')]),s._v(" --enable-underscore --enable-poll --enable-gnuregex --enable-kill-parent-hack --enable-snmp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("配置选项")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("--prefix=")]),s._v(" "),a("th",[s._v("指定安装目录")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("--sysconfdir=")]),s._v(" "),a("td",[s._v("指定配置文件路径")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-arp-acl")]),s._v(" "),a("td",[s._v("可在 ACL 中设置通过 MAC 进行管理，防止 IP 欺骗")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-linux-netfilter")]),s._v(" "),a("td",[s._v("使用内核过滤")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-linux-tproxy")]),s._v(" "),a("td",[s._v("支持透明模式")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-async-io=100")]),s._v(" "),a("td",[s._v("异步 I/O，提升储存性能，值可修改")])]),s._v(" "),a("tr",[a("td",[s._v('--enable-err-language="Simplify_Chinese"')]),s._v(" "),a("td",[s._v("错误信息的显示语言")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-underscore")]),s._v(" "),a("td",[s._v("允许 URL 中有下划线")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-poll")]),s._v(" "),a("td",[s._v("使用 poll() 模式，提升性能")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-gnuregex")]),s._v(" "),a("td",[s._v("使用 GNU 正则表达式")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-kill-parent-hack")]),s._v(" "),a("td",[s._v("关掉 Squid 的时候连同父进程一起关掉")])]),s._v(" "),a("tr",[a("td",[s._v("--enable-snmp")]),s._v(" "),a("td",[s._v("使 Squid 支持 SNMP 接口")])])])]),s._v(" "),a("p",[s._v("编译完成以后的目录层级如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("tree "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── bin\n├── conf\n├── libexec\n├── sbin\n├── share\n└── var\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置"}},[s._v("#")]),s._v(" 修改配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /app/service/squid/conf/squid.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定用户、用户组")]),s._v("\ncache_effective_user app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不指定使用 cache_effective_user 默认组")]),s._v("\ncache_effective_group app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#acl 定义，不限顺序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义网段")]),s._v("\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.1-0.255.255.255\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.0/8\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.64")]),s._v(".0.0/10\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.0/16\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".0.0/12\nacl localnet src "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/16\nacl localnet src fc00::/7\nacl localnet src fe80::/10\nacl MyNetwork src xxx.xxx.xxx.xxx/16\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义端口")]),s._v("\nacl SSL_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("210")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1025")]),s._v("-65535\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("280")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("488")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("591")]),s._v("\nacl Safe_ports port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http_access 自上而下控制访问")]),s._v("\nhttp_access deny "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("Safe_ports\nhttp_access deny CONNECT "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("SSL_ports\nhttp_access allow localhost manager\nhttp_access deny manager\n\nhttp_access allow MyNetwork\nhttp_access deny all\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#代理服务监听地址和端口，默认：3128，建议修改")]),s._v("\nhttp_port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10086")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cache_dir ufs /app/service/squid/var/cache/squid 100 16 256")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ufs：缓存数据的存储格式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/app/service/squid/var/cache/squid：缓存目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#100：缓存目录占磁盘空间大小（M）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#16：缓存空间一级子目录个数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#256：缓存空间二级子目录个数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Leave coredumps in the first cache dir")]),s._v("\ncoredump_dir /app/service/squid/var/cache/squid\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存占内存大小，单位为 MB，容量为 4 的倍数，建议设为物理内存的 1/4")]),s._v("\ncache_mem "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" MB\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限定下载文件大小，默认为 0，不限制")]),s._v("\nreply_body_max_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" MB\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最大缓存块，单位为 KB，超过限制的文件将不被缓存，直接转发给用户")]),s._v("\nmaximum_object_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" KB\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志")]),s._v("\ncache_log /app/logs/squid/cache.log\naccess_log /app/logs/squid/access.log\ncache_store_log none\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志格式")]),s._v("\nlogformat squid %tl.%03tu %6tr %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("a %Ss/%0"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("Hs %"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("st %rm %ru %un %Sh/%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("A %mt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置可见主机名")]),s._v("\nvisible_hostname squid.yuwei.cc\ncache_mgr support@yuwei.cc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#高隐匿：将 Forwarded-For 删除关掉路由")]),s._v("\nrequest_header_access X-Forwarded-For deny all\nrequest_header_access From deny all\nrequest_header_access Via deny all\nrequest_header_access Server deny all\nrequest_header_access X-Cache deny all\nrequest_header_access X-Cache-Lookup deny all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br")])]),a("h2",{attrs:{id:"运行控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行控制"}},[s._v("#")]),s._v(" 运行控制")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查配置文件语法是否正确")]),s._v("\nsquid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" parse\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-z 选项用来初始化缓存目录，第一次启动 Squid 服务时，会自动初始化缓存目录")]),s._v("\nsquid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-z")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动 squid 服务")]),s._v("\nsquid\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#前台启动并输出")]),s._v("\nsquid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d1")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#squid 端口号为 tcp 3128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-anpt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"squid"')]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定期清理 swap.state 内无效数据")]),s._v("\nsquid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" rotate "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /app/service/squid/conf/squid.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"服务脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务脚本"}},[s._v("#")]),s._v(" 服务脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chkconfig: 2345 90 25")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进程文件路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app/service/squid/var/run/squid/squid.pid"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置文件路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONF")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app/service/squid/conf/squid.conf"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#程序文件路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CMD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app/service/squid/sbin/squid"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n   start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-natp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" squid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"squid is running"')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在启动 squid..."')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CMD")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   stop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CMD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-natp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" squid\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"squid is not running"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   restart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" stop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在关闭 squid..."')]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" start "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在启动 squid..."')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   reload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CMD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" reconfigure\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CMD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" parse\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用法：'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v('{start|stop|status|reload|check|restart}"')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);