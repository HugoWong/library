(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{470:function(a,s,t){"use strict";t.r(s);var e=t(3),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"监控模板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控模板"}},[a._v("#")]),a._v(" 监控模板")]),a._v(" "),s("h3",{attrs:{id:"linux-基础监控模板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-基础监控模板"}},[a._v("#")]),a._v(" Linux 基础监控模板")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/dongwenpeng/zabbix",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/dongwenpeng/zabbix"),s("OutboundLink")],1)]),a._v(" "),s("h4",{attrs:{id:"监控内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控内容"}},[a._v("#")]),a._v(" 监控内容")]),a._v(" "),s("ul",[s("li",[a._v("CPU 监控")])]),a._v(" "),s("p",[a._v("空闲时间、中断时间、iowait时间、系统使用时间、用户使用时间、每秒上下文切换次数、每秒中断次数、负载等")]),a._v(" "),s("ul",[s("li",[a._v("内存 & Swap 监控")])]),a._v(" "),s("p",[a._v("总共内存、合法内存、使用内存、使用内存百分比、swap 空闲大小、swap 空闲百分比")]),a._v(" "),s("ul",[s("li",[a._v("系统进程监控")])]),a._v(" "),s("p",[a._v("当前进程总数、当前正在运行的进行")]),a._v(" "),s("ul",[s("li",[a._v("磁盘容量监控")])]),a._v(" "),s("p",[a._v("总大小、已经使用的和未使用的、已使用百分比、空闲 Inode 百分比；使用自动发现")]),a._v(" "),s("ul",[s("li",[a._v("磁盘状态监控")])]),a._v(" "),s("p",[a._v("rrqm/s、wrqm/s、r/s、w/s、rsec/s、wsec/s、avgrq-sz、avgqu-sz、await、r_await w_await、svctm、%util，iostat 命令获取的值")]),a._v(" "),s("ul",[s("li",[a._v("网卡接口监控")])]),a._v(" "),s("p",[a._v("网卡进出流量、Packages QPS、drop packages 统计、errors packages 统计等")]),a._v(" "),s("ul",[s("li",[a._v("网络连接监控")])]),a._v(" "),s("p",[a._v("tcp 连接状态（closewait、timewait、established、listen、finwait）等")]),a._v(" "),s("ul",[s("li",[a._v("网络 Socket 监控")])]),a._v(" "),s("p",[a._v("Socket 数量、tcp/udp mem、tcp_alloc 等\n还包括系统本地时间、系统启动时间、/etc/passwd 和 /etc/hosts 文件检测、主机名、最大打开文件数、系统信息等")]),a._v(" "),s("h4",{attrs:{id:"使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[a._v("#")]),a._v(" 使用方法")]),a._v(" "),s("p",[a._v("把 Template_Linux_System_Base.xml 文件导入到 zabbix web 界面中即可，另外需要在 zabbix-agent 端把zabbix_agentd.d 目录中的几个配置文件和 scripts 目录放在 /etc/zabbix/zabbix_agentd.d/ 目录下，然后重启zabbix-agent 即可。\n另外针对此模板还提供了 Grafana 图形展示模板，是一个 JSON 格式，直接导入到 Grafana 即可（Grafana 是一个非常漂亮的 Dashboard 展示程序）")]),a._v(" "),s("h2",{attrs:{id:"监控脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控脚本"}},[a._v("#")]),a._v(" 监控脚本")]),a._v(" "),s("h3",{attrs:{id:"监控端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控端口"}},[a._v("#")]),a._v(" 监控端口")]),a._v(" "),s("p",[a._v("创建脚本")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /etc/zabbix/scripts/\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /etc/zabbix/scripts/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" port_check.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定状态检查的端口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#端口不存在，则输出 ip:端口号 is down")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ip")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ifconfig")]),a._v(" ens8 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" inet "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{print $2}'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cut")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Is")]),a._v(" localhost:"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ip")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$port")]),a._v(" is ok "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ip")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$port")]),a._v(" is down\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("部署脚本")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/zabbix/zabbix_agentd.d/userparameter_script.conf\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("UserParameter")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/zabbix/scripts/port_check.sh\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重启 zabbix-agent")]),a._v("\nsystemctl restart zabbix-agent\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);